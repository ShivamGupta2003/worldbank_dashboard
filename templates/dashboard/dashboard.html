{% extends 'base.html' %} {% block content %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Economic Dashboard</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        position: relative;
        overflow-x: hidden;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }
      .particles {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 1;
      }
      .particle {
        position: absolute;
        width: 3px;
        height: 3px;
        background: rgba(255, 255, 255, 0.4);
        border-radius: 50%;
        animation: float 8s infinite ease-in-out;
      }
      .particle:nth-child(odd) {
        animation-duration: 6s;
      }
      .particle:nth-child(even) {
        animation-duration: 10s;
      }
      @keyframes float {
        0%,
        100% {
          transform: translateY(100vh) rotate(0deg);
          opacity: 0;
        }
        10% {
          opacity: 1;
        }
        90% {
          opacity: 1;
        }
      }
      .container-fluid {
        position: relative;
        z-index: 2;
        padding: 2rem;
        animation: containerFadeIn 1s ease-out;
      }
      @keyframes containerFadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .dashboard-header {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 20px;
        padding: 2rem;
        margin-bottom: 2rem;
        animation: headerSlide 0.8s ease-out 0.2s both;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
      }
      @keyframes headerSlide {
        from {
          opacity: 0;
          transform: translateY(-30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .dashboard-header h1 {
        color: white;
        font-weight: 700;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        animation: titleGlow 3s ease-in-out infinite alternate;
        margin: 0;
      }
      @keyframes titleGlow {
        from {
          text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        to {
          text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3),
            0 0 30px rgba(255, 255, 255, 0.4);
        }
      }
      .dashboard-header p {
        color: rgba(255, 255, 255, 0.9);
        margin: 0;
        font-size: 1.1rem;
      }
      .card {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 20px;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1),
          0 5px 15px rgba(0, 0, 0, 0.05);
        transition: all 0.3s ease;
        animation: cardSlide 0.8s ease-out both;
        margin-bottom: 2rem;
      }
      .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15),
          0 8px 20px rgba(0, 0, 0, 0.1);
      }
      .filter-card {
        animation-delay: 0.3s;
      }
      .chart-card {
        animation-delay: 0.4s;
      }
      @keyframes cardSlide {
        from {
          opacity: 0;
          transform: translateY(50px) scale(0.95);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }
      .card-header {
        background: rgba(255, 255, 255, 0.1);
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 20px 20px 0 0 !important;
        padding: 1.5rem 2rem;
      }
      .card-header h5 {
        color: white;
        font-weight: 600;
        margin: 0;
        text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
      }
      .card-body {
        padding: 2rem;
      }
      .form-label {
        color: white;
        font-weight: 600;
        margin-bottom: 0.8rem;
        display: block;
      }
      .form-select,
      .form-control {
        background: rgba(255, 255, 255, 0.1);
        border: 2px solid rgba(255, 255, 255, 0.2);
        border-radius: 12px;
        color: white;
        padding: 0.75rem 1rem;
        transition: all 0.3s ease;
      }
      .form-select:focus,
      .form-control:focus {
        background: rgba(255, 255, 255, 0.15);
        border-color: rgba(255, 255, 255, 0.5);
        box-shadow: 0 0 0 0.25rem rgba(255, 255, 255, 0.1);
        color: white;
        transform: scale(1.02);
      }
      .form-select option {
        background: #333;
        color: white;
      }
      .form-control::placeholder {
        color: rgba(255, 255, 255, 0.7);
      }
      .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        border-radius: 12px;
        padding: 0.75rem 1.5rem;
        font-weight: 600;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }
      .btn-primary::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.3),
          transparent
        );
        transition: left 0.6s ease;
      }
      .btn-primary:hover::before {
        left: 100%;
      }
      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
      }
      .chart-container {
        position: relative;
        height: 350px;
        padding: 1rem;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 15px;
        animation: chartFadeIn 1s ease-out;
      }
      @keyframes chartFadeIn {
        from {
          opacity: 0;
          transform: scale(0.9);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }
      .loading-spinner {
        display: none;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 10;
      }
      .spinner {
        width: 40px;
        height: 40px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-top: 3px solid white;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      footer {
        text-align: center;
        padding: 2rem 0 1rem 0;
        color: rgba(255, 255, 255, 0.7);
        position: relative;
        z-index: 2;
      }
      @media (max-width: 768px) {
        .container-fluid {
          padding: 1rem;
        }
        .dashboard-header {
          padding: 1.5rem;
        }
        .card-body {
          padding: 1.5rem;
        }
        .chart-container {
          height: 250px;
        }
      }
    </style>
  </head>
  <body>
    <div class="particles">
      <div class="particle" style="left: 10%; animation-delay: 0s"></div>
      <div class="particle" style="left: 20%; animation-delay: 1s"></div>
      <div class="particle" style="left: 30%; animation-delay: 2s"></div>
      <div class="particle" style="left: 40%; animation-delay: 3s"></div>
      <div class="particle" style="left: 50%; animation-delay: 4s"></div>
      <div class="particle" style="left: 60%; animation-delay: 5s"></div>
    </div>

    <div class="container-fluid">
      <div class="dashboard-header text-center">
        <h1>
          <i class="fas fa-chart-line me-3"></i>Economic Indicators Dashboard
        </h1>
        <p>
          Visualize World Bank data with interactive charts and advanced
          analytics
        </p>
      </div>

      <div class="card filter-card">
        <div class="card-header">
          <h5><i class="fas fa-filter me-2"></i>Advanced Filters</h5>
        </div>
        <div class="card-body">
          <form id="filterForm" data-api-url="{% url 'indicator_data' %}">
            <div class="row align-items-end">
            <div class="col-lg-3 col-md-6 mb-3">
  <label for="countrySelect" class="form-label">
    <i class="fas fa-flag me-2"></i>Country
  </label>
  <select class="form-select" id="countrySelect">
    <option value="" disabled>Select a Country</option>
    {% for country in countries %}
      <option value="{{ country.code }}" {% if country.code == 'IN' %}selected{% endif %}>
        {{ country.name }}
      </option>
    {% endfor %}
  </select>
</div>

              <div class="col-lg-2 col-md-6 mb-3">
                <label for="citySelect" class="form-label">
                  <i class="fas fa-city me-2"></i>City
                </label>
                <select
                  class="form-select"
                  id="citySelect"
                  disabled
                  title="City-level data is not available"
                  style="color: rgb(23, 22, 22)"
                >
                  <option value="">National Level Data</option>
                </select>
              </div>

              <div class="col-lg-3 col-md-12 mb-3">
                <label for="indicatorSelect" class="form-label"
                  ><i class="fas fa-chart-pie me-2"></i>Economic
                  Indicator</label
                >
                <select class="form-select" id="indicatorSelect">
                  <option value="NY.GDP.MKTP.CD">GDP (current US$)</option>
                  <option value="SP.POP.TOTL">Population, total</option>
                  <option value="NY.GDP.PCAP.CD">
                    GDP per capita (current US$)
                  </option>
                  <option value="FP.CPI.TOTL.ZG">
                    Inflation, consumer prices (annual %)
                  </option>
                  <option value="SL.UEM.TOTL.ZS">
                    Unemployment, total (% of total labor force)
                  </option>
                  <option value="NE.TRD.GNFS.ZS">Trade (% of GDP)</option>
                </select>
              </div>
              <div class="col-lg-2 col-6 mb-3">
                <label for="startYear" class="form-label"
                  ><i class="fas fa-calendar-alt me-2"></i>Start</label
                >
                <input
                  type="number"
                  class="form-control"
                  id="startYear"
                  value="2010"
                  min="1960"
                  max="2025"
                />
              </div>
              <div class="col-lg-2 col-6 mb-3">
                <label for="endYear" class="form-label"
                  ><i class="fas fa-calendar-check me-2"></i>End</label
                >
                <input
                  type="number"
                  class="form-control"
                  id="endYear"
                  value="2020"
                  min="1960"
                  max="2025"
                />
              </div>
              <div class="col-lg-2 col-12 mb-3 align-self-end">
                <button type="submit" class="btn btn-primary w-100">
                  <i class="fas fa-search me-2"></i>Apply
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>

      <div class="row">
        <div class="col-xl-6">
          <div class="card chart-card">
            <div class="card-header">
              <h5>
                <i class="fas fa-chart-line me-2"></i>Time Series Analysis
              </h5>
            </div>
            <div class="card-body">
              <div class="chart-container">
                <canvas id="lineChart"></canvas>
                <div class="loading-spinner"><div class="spinner"></div></div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-xl-6">
          <div class="card chart-card">
            <div class="card-header">
              <h5><i class="fas fa-chart-area me-2"></i>Trend Analysis</h5>
            </div>
            <div class="card-body">
              <div class="chart-container">
                <canvas id="areaChart"></canvas>
                <div class="loading-spinner"><div class="spinner"></div></div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-xl-6">
          <div class="card chart-card">
            <div class="card-header">
              <h5><i class="fas fa-chart-bar me-2"></i>Annual Comparison</h5>
            </div>
            <div class="card-body">
              <div class="chart-container">
                <canvas id="barChart"></canvas>
                <div class="loading-spinner"><div class="spinner"></div></div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-xl-6">
          <div class="card chart-card">
            <div class="card-header">
              <h5>
                <i class="fas fa-chart-pie me-2"></i>Distribution Analysis
              </h5>
            </div>
            <div class="card-body">
              <div class="chart-container">
                <canvas id="doughnutChart"></canvas>
                <div class="loading-spinner"><div class="spinner"></div></div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-xl-6">
          <div class="card chart-card">
            <div class="card-header">
              <h5>
                <i class="fas fa-satellite-dish me-2"></i>Multi-dimensional View
              </h5>
            </div>
            <div class="card-body">
              <div class="chart-container">
                <canvas id="radarChart"></canvas>
                <div class="loading-spinner"><div class="spinner"></div></div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-xl-6">
          <div class="card chart-card">
            <div class="card-header">
              <h5><i class="fas fa-braille me-2"></i>Correlation Analysis</h5>
            </div>
            <div class="card-body">
              <div class="chart-container">
                <canvas id="scatterChart"></canvas>
                <div class="loading-spinner"><div class="spinner"></div></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <footer>
        <p>Economic Dashboard &copy; <span id="currentYear">2025</span></p>
      </footer>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const chartColors = {
          primary: "#8A4213",
          secondary: "#764ba2",
          accent: "#f093fb",
          success: "#4facfe",
          warning: "#ffeaa7",
          danger: "#fd79a8",
          gradient: {
            line: ["rgba(102, 126, 234, 0.8)", "rgba(118, 75, 162, 0.8)"],
            area: ["rgba(102, 126, 234, 0.3)", "rgba(118, 75, 162, 0.3)"],
            bar: ["rgba(102, 126, 234, 0.7)", "rgba(118, 75, 162, 0.7)"],
          },
        };
        const sampleData = {
          years: [
            "2010",
            "2011",
            "2012",
            "2013",
            "2014",
            "2015",
            "2016",
            "2017",
            "2018",
            "2019",
            "2020",
          ],
          gdp: [
            14.99, 15.54, 16.25, 16.84, 17.52, 18.04, 18.57, 19.49, 20.58,
            21.43, 20.95,
          ],
          population: [
            309.3, 311.6, 313.9, 316.1, 318.4, 320.7, 323.1, 325.7, 328.2,
            330.7, 331.4,
          ],
          gdpPerCapita: [
            48.4, 49.8, 51.8, 53.3, 54.9, 56.3, 57.6, 59.9, 62.8, 65.3, 63.5,
          ],
          inflation: [2.1, 3.1, 2.1, 1.5, 0.1, 0.1, 1.3, 2.1, 2.4, 1.8, 1.2],
          unemployment: [9.6, 8.9, 8.1, 7.4, 6.2, 5.3, 4.9, 4.4, 3.9, 3.7, 8.1],
          trade: [
            29.1, 30.4, 29.9, 29.4, 29.7, 28.1, 27.7, 27.9, 27.1, 26.4, 25.3,
          ],
        };
        const charts = {};

        const defaultOptions = {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            title: { display: true, color: "#fff", font: { size: 16 } },
            legend: { labels: { color: "#fff" } },
          },
          scales: {
            x: {
              ticks: { color: "#fff" },
              grid: { color: "rgba(255, 255, 255, 0.1)" },
            },
            y: {
              ticks: { color: "#fff" },
              grid: { color: "rgba(255, 255, 255, 0.1)" },
            },
          },
        };

        charts.lineChart = new Chart(
          document.getElementById("lineChart").getContext("2d"),
          {
            type: "line",
            data: {
              labels: sampleData.years,
              datasets: [
                {
                  label: "GDP (Trillion USD)",
                  data: sampleData.gdp,
                  borderColor: chartColors.primary,
                  backgroundColor: "rgba(102, 126, 234, 0.1)",
                  tension: 0.4,
                  fill: true,
                  pointBackgroundColor: "#fff",
                  pointBorderColor: chartColors.primary,
                  pointBorderWidth: 2,
                  pointRadius: 5,
                },
              ],
            },
            options: {
              ...defaultOptions,
              plugins: {
                ...defaultOptions.plugins,
                title: {
                  ...defaultOptions.plugins.title,
                  text: "GDP Over Time",
                },
              },
            },
          }
        );
        charts.barChart = new Chart(
          document.getElementById("barChart").getContext("2d"),
          {
            type: "bar",
            data: {
              labels: sampleData.years,
              datasets: [
                {
                  label: "GDP per Capita (Thousand USD)",
                  data: sampleData.gdpPerCapita.slice(-5),
                  backgroundColor: chartColors.gradient.bar,
                  borderColor: chartColors.primary,
                  borderWidth: 2,
                  borderRadius: 8,
                },
              ],
            },
            options: {
              ...defaultOptions,
              plugins: {
                ...defaultOptions.plugins,
                title: {
                  ...defaultOptions.plugins.title,
                  text: "GDP per Capita (Recent Years)",
                },
              },
              scales: {
                ...defaultOptions.scales,
                y: { ...defaultOptions.scales.y, beginAtZero: true },
              },
            },
          }
        );
        charts.areaChart = new Chart(
          document.getElementById("areaChart").getContext("2d"),
          {
            type: "line",
            data: {
              labels: sampleData.years,
              datasets: [
                {
                  label: "Population (Millions)",
                  data: sampleData.population,
                  backgroundColor: "rgba(102, 126, 234, 0.3)",
                  borderColor: chartColors.primary,
                  fill: true,
                  tension: 0.4,
                },
              ],
            },
            options: {
              ...defaultOptions,
              plugins: {
                ...defaultOptions.plugins,
                title: {
                  ...defaultOptions.plugins.title,
                  text: "Population Growth Trend",
                },
              },
            },
          }
        );
        charts.doughnutChart = new Chart(
          document.getElementById("doughnutChart").getContext("2d"),
          {
            type: "doughnut",
            data: {
              labels: [
                "GDP",
                "Population",
                "Trade",
                "Unemployment",
                "Inflation",
              ],
              datasets: [
                {
                  data: [65, 15, 10, 5, 5],
                  backgroundColor: [
                    chartColors.primary,
                    chartColors.secondary,
                    chartColors.accent,
                    chartColors.success,
                    chartColors.warning,
                  ],
                  borderColor: "#fff",
                  borderWidth: 2,
                  hoverOffset: 10,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              cutout: "60%",
              plugins: {
                title: {
                  display: true,
                  text: "Economic Indicators Distribution",
                  color: "#fff",
                },
                legend: {
                  position: "bottom",
                  labels: { color: "#fff", padding: 15, usePointStyle: true },
                },
              },
            },
          }
        );
        charts.radarChart = new Chart(
          document.getElementById("radarChart").getContext("2d"),
          {
            type: "radar",
            data: {
              labels: [
                "GDP Growth",
                "Population",
                "Trade",
                "Employment",
                "Price Stability",
              ],
              datasets: [
                {
                  label: "Current Year",
                  data: [8, 6, 7, 8, 9],
                  backgroundColor: "rgba(102, 126, 234, 0.2)",
                  borderColor: chartColors.primary,
                  pointBackgroundColor: chartColors.primary,
                  pointBorderColor: "#fff",
                  pointRadius: 6,
                },
                {
                  label: "Previous Year",
                  data: [6, 5, 6, 7, 8],
                  backgroundColor: "rgba(118, 75, 162, 0.2)",
                  borderColor: chartColors.secondary,
                  pointBackgroundColor: chartColors.secondary,
                  pointBorderColor: "#fff",
                  pointRadius: 6,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                title: {
                  display: true,
                  text: "Multi-Dimensional Economic View",
                  color: "#fff",
                },
                legend: { labels: { color: "#fff" } },
              },
              scales: {
                r: {
                  beginAtZero: true,
                  max: 10,
                  ticks: { color: "#fff", backdropColor: "transparent" },
                  grid: { color: "rgba(255, 255, 255, 0.1)" },
                  angleLines: { color: "rgba(255, 255, 255, 0.1)" },
                  pointLabels: { color: "#fff" },
                },
              },
            },
          }
        );
        charts.scatterChart = new Chart(
          document.getElementById("scatterChart").getContext("2d"),
          {
            type: "scatter",
            data: {
              datasets: [
                {
                  label: "GDP vs Population",
                  data: sampleData.years.map((year, index) => ({
                    x: sampleData.population[index],
                    y: sampleData.gdp[index],
                  })),
                  backgroundColor: chartColors.primary,
                  borderColor: chartColors.primary,
                  pointRadius: 8,
                  pointHoverRadius: 12,
                },
              ],
            },
            options: {
              ...defaultOptions,
              plugins: {
                ...defaultOptions.plugins,
                title: {
                  ...defaultOptions.plugins.title,
                  text: "GDP vs Population Correlation",
                },
              },
              scales: {
                x: {
                  ...defaultOptions.scales.x,
                  type: "linear",
                  position: "bottom",
                  title: {
                    display: true,
                    text: "Population (Millions)",
                    color: "#fff",
                  },
                },
                y: {
                  ...defaultOptions.scales.y,
                  title: {
                    display: true,
                    text: "GDP (Trillion USD)",
                    color: "#fff",
                  },
                },
              },
            },
          }
        );

        document
          .getElementById("filterForm")
          .addEventListener("submit", (e) => {
            e.preventDefault();
            updateCharts();
          });

        function updateCharts() {
          const form = document.getElementById("filterForm");
          const apiUrl = form.dataset.apiUrl;
          const params = new URLSearchParams({
            country: document.getElementById("countrySelect").value,
            indicator: document.getElementById("indicatorSelect").value,
            start_year: document.getElementById("startYear").value,
            end_year: document.getElementById("endYear").value,
          });
          if (!params.get("country")) {
            showNotification("Please select a country.", "warning");
            return;
          }
          showLoadingSpinners();
          fetch(`${apiUrl}?${params.toString()}`)
            .then((response) => {
              if (!response.ok) {
                return response.json().then((err) => {
                  throw new Error(
                    err.error || `API Error: ${response.statusText}`
                  );
                });
              }
              return response.json();
            })
            .then((data) => {
              hideLoadingSpinners();
              updateChartData(data);
              const countryName =
                document.getElementById("countrySelect").options[
                  document.getElementById("countrySelect").selectedIndex
                ].text;
              showNotification(`Charts updated for ${countryName}`, "success");
            })
            .catch((error) => {
              hideLoadingSpinners();
              console.error("Fetch Error:", error);
              showNotification(error.message, "danger");
            });
        }

        function showLoadingSpinners() {
          document
            .querySelectorAll(".loading-spinner")
            .forEach((s) => (s.style.display = "block"));
        }
        function hideLoadingSpinners() {
          document
            .querySelectorAll(".loading-spinner")
            .forEach((s) => (s.style.display = "none"));
        }

        function updateChartData(data) {
          const { years, values, indicator_name, country_name } = data;
          const yearStrings = years.map(String);
          charts.lineChart.data.labels = yearStrings;
          charts.lineChart.data.datasets[0].data = values;
          charts.lineChart.data.datasets[0].label = indicator_name;
          charts.lineChart.options.plugins.title.text = `${indicator_name} for ${country_name}`;
          charts.lineChart.update();
          charts.barChart.data.labels = yearStrings;
          charts.barChart.data.datasets[0].data = values;
          charts.barChart.data.datasets[0].label = indicator_name;
          charts.barChart.options.plugins.title.text = `Annual Comparison for ${country_name}`;
          charts.barChart.update();
          charts.areaChart.data.labels = yearStrings;
          charts.areaChart.data.datasets[0].data = values;
          charts.areaChart.data.datasets[0].label = indicator_name;
          charts.areaChart.options.plugins.title.text = `Trend Analysis for ${country_name}`;
          charts.areaChart.update();
          charts.scatterChart.data.datasets[0].data = years.map((year, i) => ({
            x: year,
            y: values[i],
          }));
          charts.scatterChart.options.scales.x.title.text = "Year";
          charts.scatterChart.options.scales.y.title.text = indicator_name;
          charts.scatterChart.options.plugins.title.text = `Correlation for ${country_name}`;
          charts.scatterChart.update();
          charts.radarChart.data.datasets[0].data = calculateRadarData(values);
          charts.radarChart.data.datasets[0].label = `${years[0]}-${
            years[years.length - 1]
          }`;
          charts.radarChart.update();
        }

        function calculateRadarData(data) {
          if (!data || data.length < 2) return [0, 0, 0, 0, 0];
          const maxVal = Math.max(...data);
          const minVal = Math.min(...data);
          const avgVal = data.reduce((a, b) => a + b, 0) / data.length;
          const midPoint = Math.floor(data.length / 2);
          const firstHalfAvg =
            data.slice(0, midPoint).reduce((a, b) => a + b, 0) /
            (midPoint || 1);
          const secondHalfAvg =
            data.slice(midPoint).reduce((a, b) => a + b, 0) /
            (data.length - midPoint || 1);
          const growthRate =
            firstHalfAvg > 0
              ? ((secondHalfAvg - firstHalfAvg) / firstHalfAvg) * 10
              : 0;
          const range = maxVal - minVal;
          const stdev = Math.sqrt(
            data.map((x) => Math.pow(x - avgVal, 2)).reduce((a, b) => a + b) /
              data.length
          );
          const stability =
            range > 0 ? 10 - Math.min(10, (stdev / range) * 10) : 10;
          return [
            Math.min(10, Math.abs(avgVal / (maxVal || 1)) * 10),
            Math.max(-10, Math.min(10, growthRate)),
            Math.max(0, Math.min(10, stability)),
            Math.min(10, Math.abs(data[data.length - 1] / (maxVal || 1)) * 10),
            5,
          ];
        }

        function showNotification(message, type) {
          const notification = document.createElement("div");
          notification.className = `alert alert-${type} position-fixed`;
          notification.style.cssText = `top: 20px; right: 20px; z-index: 9999; min-width: 300px; animation: slideInRight 0.5s ease-out;`;
          notification.innerHTML = `<i class="fas fa-check-circle me-2"></i> ${message} <button type="button" class="btn-close" onclick="this.parentElement.remove()"></button>`;
          document.body.appendChild(notification);
          setTimeout(() => {
            notification.remove();
          }, 3000);
        }
        const style = document.createElement("style");
        style.textContent = `@keyframes slideInRight { from { opacity: 0; transform: translateX(100%); } to { opacity: 1; transform: translateX(0); } }`;
        document.head.appendChild(style);

        document.getElementById("currentYear").textContent =
          new Date().getFullYear();
          updateCharts();
      });
    </script>
  </body>
</html>
{% endblock %}
